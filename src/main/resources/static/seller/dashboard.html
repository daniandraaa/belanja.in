<!DOCTYPE html>
<html>
<head>
  <title>Dashboard Penjual</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="/seller/dashboard.html">Seller Dashboard</a>
      <div>
        <a href="/seller/create.html" class="btn btn-outline-light">+ Tambah Produk</a>
        <a href="/buyer/index.html" class="btn btn-outline-warning">Lihat Toko</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <h2 class="mb-4">Daftar Pesanan Masuk</h2>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nama</th>
          <th>Produk</th>
          <th>Jumlah</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="orders"></tbody>
    </table>
  </div>

  <script>
    function loadOrders() {
      fetch('http://localhost:8080/api/buyer/orders')
        .then(res => res.ok ? res.json() : [])
        .then(data => {
          const table = document.getElementById("orders");
          table.innerHTML = "";

          if (!Array.isArray(data)) {
            console.error("Data bukan array:", data);
            return;
          }

          data.forEach(o => {
            table.innerHTML += `
              <tr>
                <td>${o.id}</td>
                <td>${o.buyerName}</td>
                <td>${o.product?.name || '-'}</td>
                <td>${o.quantity}</td>
                <td>${o.status}</td>
                <td>
                  <button onclick="updateStatus(${o.id}, 'Diproses')" class="btn btn-sm btn-warning">Proses</button>
                  <button onclick="updateStatus(${o.id}, 'Dikirim')" class="btn btn-sm btn-info">Kirim</button>
                  <button onclick="updateStatus(${o.id}, 'Selesai')" class="btn btn-sm btn-success">Selesai</button>
                </td>
              </tr>`;
          });
        });
    }

    function updateStatus(id, status) {
      fetch(`http://localhost:8080/api/buyer/orders/${id}/status?status=${status}`, {
        method: "PUT"
      }).then(() => loadOrders());
    }

    function checkNewOrders() {
      console.log("Simulasi cek order baru...");
    }

    loadOrders();
    setInterval(checkNewOrders, 10000);
  </script>
</body>
</html>
